<!DOCTYPE html>

<html>
<head>
<script type="text/javascript"
	src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>

<script type="text/javascript">
	var webSocket;
	var map;
	var marker;
	var myOptions;
	var latlng;
	var messages = document.getElementById("messages");

	function openSocket() {
		console.log("opening connection");

		if (webSocket !== undefined
				&& webSocket.readyState !== WebSocket.CLOSED) {
			return;
		}

		webSocket = new WebSocket("ws://localhost:8080/DroneSimulation/echo");

		webSocket.onopen = function(event) {
			if (event.data === undefined)
				return;
			console.log("On Open : " + event.data);
		};

		webSocket.onmessage = function(event) {
			console.log("Drone Location : " + event.data);
			writeResponse(event.data);
		};

		webSocket.onclose = function(event) {
		};
	}

	function send() {
		//var text = document.getElementById("messageinput").value;
		webSocket.send("");
	}

	function closeSocket() {
		webSocket.close();
	}

	function writeResponse(text) {
		var latLong = JSON.parse(text);
		// messages.innerHTML += "<br/>" + "Lat : "+latLong.lattitude;
		marker.setPosition(new google.maps.LatLng(latLong.lattitude,
				latLong.longitude));
	}

	function initialize() {
		latlng = new google.maps.LatLng(18.5106787, 73.777601);
		myOptions = {
			zoom : 4,
			center : latlng,
			mapTypeId : google.maps.MapTypeId.ROADMAP
		};
		map = new google.maps.Map(document.getElementById("map_container"),
				myOptions);

		marker = new google.maps.Marker({
			position : latlng,
			map : map,
			title : "drone_webonise_ph"
		});
	}
</script>
<title>Drone Tracker</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<style type="text/css">
div#map_container {
	width: 100%;
	height: 350px;
}
</style>
</head>
<body onload="initialize()">

	<div>
		<input type="text" id="messageinput" />
	</div>
	<div>
		<button type="button" onclick="openSocket();">Open</button>
		<button type="button" onclick="send();">Send</button>
		<button type="button" onclick="closeSocket();">Close</button>
	</div>
	<div id="map_container"></div>
	<div id="messages"></div>
</body>
</html>